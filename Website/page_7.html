<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DCU Research Ethics Application Form - Section 7</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Link to custom CSS -->
    <link href="/Design/styles.css" rel="stylesheet" />
    <!-- jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>

<body>
    <!-- Section 7 - Supplementary Documentation -->
    <div class="container">
        <h2 class="section-heading">SECTION 7 – SUPPLEMENTARY DOCUMENTATION</h2>
        <fieldset class="fieldset">
            <legend>Section 7</legend>
            <p>
                Please attach all required documentation as confirmed by you in the
                previous section. The application should then be saved as one file in
                PDF format before submission via the
                <a href="https://loop.dcu.ie/enrol/index.php?id=45490" target="_blank">Research Ethics Application
                    Portal</a>
                on Loop.
            </p>
        </fieldset>

        <!-- Buttons -->
        <div class="buttons">
            <button type="button" class="btn btn-primary" onclick="generatePDF()">Generate PDF</button>
            <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
        </div>
    </div>
    <br /><br />

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Script to generate PDF and reset form -->
    <script>
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Helper functions for adding content
            const addSectionHeader = (title, yPos) => {
                doc.setFontSize(14);
                doc.setFont('Helvetica', 'bold');
                doc.setFillColor(106, 122, 125);
                doc.rect(10, yPos, 190, 10, 'F');
                doc.setTextColor(255, 255, 255);
                doc.text(title, 15, yPos + 7);
                doc.setTextColor(0, 0, 0);
                return yPos + 15;
            };

            const addSubsection = (title, content, yPos) => {
                doc.setFontSize(12);
                doc.setFont('Helvetica', 'bold');
                doc.text(title, 10, yPos);
                doc.setFont('Helvetica', 'normal');
                const lines = doc.splitTextToSize(content, 180);
                doc.text(lines, 20, yPos + 5);
                return yPos + 5 + lines.length * 6;
            };

            const addNewPageIfNeeded = (yPos) => {
                if (yPos > 280) {
                    doc.addPage();
                    yPos = 20;
                }
                return yPos;
            };

            const addInvestigatorDetails = (title, details, yPos) => {
                doc.setFontSize(12);
                doc.setFont('Helvetica', 'bold');
                doc.text(title, 10, yPos);
                doc.setFont('Helvetica', 'normal');
                details.forEach(detail => {
                    const lines = doc.splitTextToSize(detail, 180);
                    doc.text(lines, 20, yPos + 5);
                    yPos += lines.length * 6 + 2;
                });
                return yPos + 5;
            };

            const addCheckbox = (label, isChecked, yPos) => {
                doc.setFontSize(12);
                doc.setFont('Helvetica', 'normal');
                const lines = doc.splitTextToSize(label, 180);
                if (isChecked) {
                    doc.setFont('ZapfDingbats');
                    doc.text('4', 10, yPos); // Checked box
                    doc.setFont('Helvetica', 'normal');
                } else {
                    doc.rect(10, yPos - 4, 4, 4); // Unchecked box
                }
                doc.text(lines, 20, yPos);
                return yPos + 6 + lines.length * 6;
            };

            const addYesNoOptions = (label, yesSelected, yPos) => {
                if (yesSelected !== null) {
                    doc.setFontSize(12);
                    doc.setFont('Helvetica', 'normal');
                    const lines = doc.splitTextToSize(label, 180);
                    doc.text(lines, 20, yPos);
                    if (yesSelected) {
                        doc.setFont('ZapfDingbats');
                        doc.text('4', 110, yPos); // Checked box for Yes
                        doc.setFont('Helvetica', 'normal');
                        doc.text('Yes', 115, yPos);
                        doc.rect(140, yPos - 4, 4, 4); // Unchecked box for No
                        doc.text('No', 145, yPos);
                    } else {
                        doc.rect(110, yPos - 4, 4, 4); // Unchecked box for Yes
                        doc.text('Yes', 115, yPos);
                        doc.setFont('ZapfDingbats');
                        doc.text('4', 140, yPos); // Checked box for No
                        doc.setFont('Helvetica', 'normal');
                        doc.text('No', 145, yPos);
                    }
                    return yPos + 6 + lines.length * 6;
                }
                return yPos;
            };

            let yPosition = 20;

            // Title
            doc.setFontSize(16);
            doc.setFont('Helvetica', 'bold');
            doc.text('Research Ethics Application Form', 105, yPosition, null, null, 'center');
            yPosition += 20;

            // Retrieve data from localStorage and add it to the PDF
            const addSectionContent = (sectionNumber, sectionTitle, keys) => {
                yPosition = addSectionHeader(`${sectionNumber} – ${sectionTitle}`, yPosition);
                keys.forEach(([key, title]) => {
                    let value = localStorage.getItem(key);
                    if (value && value !== 'Not provided') {
                        // Check if the value is a JSON array and convert it to a string
                        try {
                            const parsedValue = JSON.parse(value);
                            if (Array.isArray(parsedValue)) {
                                value = parsedValue.join(', ');
                            }
                        } catch (e) {
                            // Not a JSON array, use the value as is
                        }
                        yPosition = addSubsection(title, value, yPosition);
                        yPosition = addNewPageIfNeeded(yPosition);
                    }
                });
            };

            // Add Section 1 content
            addSectionContent('SECTION 1', 'GENERAL DETAILS', [
                ['projectTitle', '1.1 Project Title:']
            ]);

            yPosition = addSectionHeader('1.2 Applicant Details', yPosition);

            const piNames = JSON.parse(localStorage.getItem('piNames') || '[]');
            const piSchools = JSON.parse(localStorage.getItem('piSchools') || '[]');
            const piEmails = JSON.parse(localStorage.getItem('piEmails') || '[]');
            const otherNames = JSON.parse(localStorage.getItem('otherNames') || '[]');
            const otherUnits = JSON.parse(localStorage.getItem('otherUnits') || '[]');
            const otherEmails = JSON.parse(localStorage.getItem('otherEmails') || '[]');

            yPosition = addSubsection('1.2.1 DCU Principal Investigator(s)', '', yPosition);
            for (let i = 0; i < piNames.length; i++) {
                yPosition = addInvestigatorDetails('DCU Principal Investigator Names:', [piNames[i]], yPosition);
                yPosition = addInvestigatorDetails('DCU Principal Investigator Schools/Units:', [piSchools[i]], yPosition);
                yPosition = addInvestigatorDetails('DCU Principal Investigator Emails:', [piEmails[i]], yPosition);
            }

            yPosition = addSubsection('1.2.2 Other Investigators', '', yPosition);
            for (let i = 0; i < otherNames.length; i++) {
                yPosition = addInvestigatorDetails('Other Investigator Names:', [otherNames[i]], yPosition);
                yPosition = addInvestigatorDetails('Other Investigator Schools/Units:', [otherUnits[i]], yPosition);
                yPosition = addInvestigatorDetails('Other Investigator Emails:', [otherEmails[i]], yPosition);
            }

            addSectionContent('SECTION 1.3', 'Key Project Dates', [
                ['startDate', '1.3 Proposed start date for data collection:'],
                ['endDate', '1.3 Proposed end date for data collection:'],
                ['completionDate', '1.3 Proposed project completion date:']
            ]);

            addSectionContent('SECTION 1.5', 'Academic Award', [
                ['academicAward', '1.5 Academic Award:']
            ]);

            yPosition = addSectionHeader('1.6 Locations', yPosition);
            yPosition = addCheckbox('DCU campus', localStorage.getItem('location-DCU campus') === 'true', yPosition);
            yPosition = addCheckbox('Dublin City', localStorage.getItem('location-Dublin City') === 'true', yPosition);
            yPosition = addCheckbox('Republic of Ireland', localStorage.getItem('location-Republic of Ireland') === 'true', yPosition);
            yPosition = addCheckbox('Online / On the Internet', localStorage.getItem('location-Online / On the Internet') === 'true', yPosition);
            yPosition = addCheckbox('Other', localStorage.getItem('location-Other') === 'true', yPosition);

            const otherLocation = localStorage.getItem('otherLocation');
            if (otherLocation) {
                yPosition = addSubsection('Other Location Details:', otherLocation, yPosition);
            }

            addSectionContent('SECTION 1.7', 'Permissions Required to Access Locations', [
                ['permissions', '1.7 Permissions Required to Access Locations:']
            ]);

            addSectionContent('SECTION 1.8', 'Other Ethics Committee Review', [
                ['otherCommitteeReview', '1.8 Other Ethics Committee Review:'],
                ['detailsOutcome', 'Details on the outcome:']
            ]);

            // Add Section 2 content
            yPosition = addSectionHeader('SECTION 2 – PROJECT DESIGN AND METHODOLOGY', yPosition);

            yPosition = addSectionHeader('2.1 Technologies Involved', yPosition);
            yPosition = addCheckbox('Smartphone app', localStorage.getItem('smartphone-app') === 'true', yPosition);
            yPosition = addCheckbox('Website', localStorage.getItem('website') === 'true', yPosition);
            yPosition = addCheckbox('Machine-learning', localStorage.getItem('machine-learning') === 'true', yPosition);
            yPosition = addCheckbox('NLP', localStorage.getItem('nlp') === 'true', yPosition);
            yPosition = addCheckbox('LLMs', localStorage.getItem('llms') === 'true', yPosition);

            addSectionContent('2.2', 'Aims and Objectives', [
                ['aims-objectives', 'Please state the aims and objectives of the research project (max 200 words):']
            ]);

            addSectionContent('2.3', 'Hypothesis/Research Question', [
                ['hypothesis', 'Please state the hypothesis and/or research question (in bullet points – max 100 words):']
            ]);

            addSectionContent('2.4', 'Methodology', [
                ['methodology', 'Please state your overall methodology (max 400 words):']
            ]);

            yPosition = addSectionHeader('2.5 Methods of Data Collection', yPosition);
            yPosition = addCheckbox('Interviews or focus groups', localStorage.getItem('interviews') === 'true', yPosition);
            yPosition = addCheckbox('Surveys/questionnaires', localStorage.getItem('surveys') === 'true', yPosition);
            yPosition = addCheckbox('Audio/video recordings', localStorage.getItem('recordings') === 'true', yPosition);
            yPosition = addCheckbox('Public observations', localStorage.getItem('observations') === 'true', yPosition);
            yPosition = addCheckbox('Persons in public office', localStorage.getItem('public-office') === 'true', yPosition);
            yPosition = addCheckbox('Using existing data (including secondary data)', localStorage.getItem('existing-data') === 'true', yPosition);
            yPosition = addCheckbox('Using human derived material (biological samples)', localStorage.getItem('biological-samples') === 'true', yPosition);
            yPosition = addCheckbox('Standard tests (educational/personality, etc.)', localStorage.getItem('standard-tests') === 'true', yPosition);
            yPosition = addCheckbox('Standard educational practices', localStorage.getItem('educational-practices') === 'true', yPosition);
            yPosition = addCheckbox('Other (please specify)', localStorage.getItem('other-data-collection') === 'true', yPosition);

            const otherDataCollectionDetails = localStorage.getItem('other-data-collection-details');
            if (otherDataCollectionDetails) {
                yPosition = addSubsection('Other Data Collection Details:', otherDataCollectionDetails, yPosition);
            }

            yPosition = addSectionHeader('2.6a Participants Group', yPosition);
            yPosition = addCheckbox('DCU students', localStorage.getItem('dcu-students') === 'true', yPosition);
            yPosition = addCheckbox('Friends', localStorage.getItem('friends') === 'true', yPosition);
            yPosition = addCheckbox('Family', localStorage.getItem('family') === 'true', yPosition);
            yPosition = addCheckbox('Anyone', localStorage.getItem('anyone') === 'true', yPosition);

            yPosition = addSectionHeader('2.6b Age Range', yPosition);
            yPosition = addCheckbox('18-60 i.e. Adults', localStorage.getItem('18-60') === 'true', yPosition);
            yPosition = addCheckbox('60+ i.e. Older Adults', localStorage.getItem('60+') === 'true', yPosition);
            yPosition = addCheckbox('16-18', localStorage.getItem('16-18') === 'true', yPosition);
            yPosition = addCheckbox('12-16', localStorage.getItem('12-16') === 'true', yPosition);
            yPosition = addCheckbox('less than 12', localStorage.getItem('less-than-12') === 'true', yPosition);

            yPosition = addSectionHeader('2.6c Demographics for Choosing Participants', yPosition);
            yPosition = addCheckbox('Male', localStorage.getItem('male') === 'true', yPosition);
            yPosition = addCheckbox('Female', localStorage.getItem('female') === 'true', yPosition);
            yPosition = addCheckbox('Other', localStorage.getItem('other') === 'true', yPosition);
            yPosition = addCheckbox('Any', localStorage.getItem('any') === 'true', yPosition);
            yPosition = addCheckbox('Race e.g. Caucasian', localStorage.getItem('race') === 'true', yPosition);
            yPosition = addCheckbox('Physical Characteristics e.g. height, blood type, eye colour', localStorage.getItem('physical-characteristics') === 'true', yPosition);
            yPosition = addCheckbox('No particular demographics and characteristics are required i.e. anybody can participate', localStorage.getItem('no-demographics') === 'true', yPosition);

            addSectionContent('2.6d', 'Demographics and characteristics for excluding participants', [
                ['excluding-demographics', 'What demographics and characteristics will you use when excluding potential participants?']
            ]);

            addSectionContent('2.7', 'Recruitment Process', [
                ['recruitment-method', 'How will you recruit participants?']
            ]);

            yPosition = addSectionHeader('2.8 Addressing Participant Vulnerability', yPosition);
            yPosition = addCheckbox('N/A', localStorage.getItem('n/a') === 'true', yPosition);
            yPosition = addCheckbox('Children under 18 years of age', localStorage.getItem('children') === 'true', yPosition);
            yPosition = addCheckbox('Persons in unequal relationships with the researcher (e.g. lecturer-student, therapist-client, employer-employee)', localStorage.getItem('unequal-relationships') === 'true', yPosition);
            yPosition = addCheckbox('People with a recognized or diagnosed intellectual, physical, or mental impairment', localStorage.getItem('impairment') === 'true', yPosition);
            yPosition = addCheckbox('People confined to institutions (e.g. prisoners, residents in 24 hr nursing facilities)', localStorage.getItem('institutions') === 'true', yPosition);
            yPosition = addCheckbox('People who have undergone traumatic or adverse emotional events', localStorage.getItem('traumatic-events') === 'true', yPosition);
            yPosition = addCheckbox('People with diminished cognitive ability', localStorage.getItem('cognitive-ability') === 'true', yPosition);
            yPosition = addCheckbox('Marginalized sections of society', localStorage.getItem('marginalized') === 'true', yPosition);
            yPosition = addCheckbox('Other (please specify)', localStorage.getItem('other-vulnerability') === 'true', yPosition);

            const otherVulnerabilityDetails = localStorage.getItem('other-vulnerability-details');
            if (otherVulnerabilityDetails) {
                yPosition = addSubsection('Other Vulnerability Details:', otherVulnerabilityDetails, yPosition);
            }

            yPosition = addSectionHeader('2.9 Involvement of Children under 18', yPosition);
            yPosition = addCheckbox('N/A', localStorage.getItem('children-na') === 'true', yPosition);
            yPosition = addCheckbox('We confirm that we have read and agree to act in accordance with the DCU Child Protection policy and procedures', localStorage.getItem('child-protection-policy') === 'true', yPosition);
            yPosition = addCheckbox('We confirm that we have put in place safeguards for the children participating in the research.', localStorage.getItem('safeguards') === 'true', yPosition);
            yPosition = addCheckbox('We confirm that we have supports in place for children who may disclose current or historical abuse', localStorage.getItem('supports') === 'true', yPosition);
            yPosition = addCheckbox('We confirm that all requirements will be met prior to commencing the research', localStorage.getItem('requirements') === 'true', yPosition);

            yPosition = addSectionHeader('2.10 Dissemination of Results', yPosition);
            yPosition = addCheckbox('Posted on a website', localStorage.getItem('dissemination-website') === 'true', yPosition);
            yPosition = addCheckbox('Shared on social media', localStorage.getItem('dissemination-social-media') === 'true', yPosition);
            yPosition = addCheckbox('Will not be shared', localStorage.getItem('dissemination-not-shared') === 'true', yPosition);
            yPosition = addCheckbox('Other (please specify)', localStorage.getItem('dissemination-other') === 'true', yPosition);

            const otherDisseminationDetails = localStorage.getItem('dissemination-other-details');
            if (otherDisseminationDetails) {
                yPosition = addSubsection('Other Dissemination Details:', otherDisseminationDetails, yPosition);
            }

            // Add Section 3 content
            yPosition = addSectionHeader('SECTION 3 – ETHICAL ISSUES AND RISK MANAGEMENT', yPosition);

            addSectionContent('3.1', 'Ethical Issues', [
                ['ethicalIssuesSelect', 'Indicate how you are addressing the following ethical issues:']
            ]);

            const ethicalIssues = {
                genderBalance: 'Ensure gender balance in recruiting participants',
                confidentiality: 'Maintain confidentiality of participant data',
                informedConsent: 'Obtain informed consent',
                riskMinimization: 'Minimize potential risks to participants',
                dataProtection: 'Ensure data protection and privacy'
            };

            for (const [key, title] of Object.entries(ethicalIssues)) {
                if (localStorage.getItem(key + 'Text')) {
                    yPosition = addSubsection(title, localStorage.getItem(key + 'Text'), yPosition);
                }
            }

            addSectionContent('3.2', 'Potential Benefits', [
                ['benefits', 'Please identify the potential benefits (direct and/or indirect) to those participating in this research:'],
                ['benefitsOtherText', 'Other benefits details:']
            ]);

            addSectionContent('3.3', 'Unexpected Outcomes', [
                ['unexpectedOutcomesOtherText1', 'Communication channel with the supervisor:'],
                ['unexpectedOutcomesOtherText2', 'Notify participants:'],
                ['unexpectedOutcomesOtherText3', 'Other unexpected outcomes:']
            ]);

            addSectionContent('3.4', 'Risks to Researchers', [
                ['risksResearchersOtherText1', 'No risk details:'],
                ['risksResearchersOtherText2', 'Defamation details:'],
                ['risksResearchersOtherText3', 'Legal liability details:'],
                ['risksResearchersOtherText4', 'Harm to physical safety details:'],
                ['risksResearchersOtherText5', 'Other risks:']
            ]);

            addSectionContent('3.5', 'Funding', [
                ['fundingType', 'Does this project require funding?'],
                ['fundingDetailsText', 'Funding details:']
            ]);

            addSectionContent('3.6', 'Conflict of Interest', [
                ['conflictInterest', 'Does this research raise any of the following conflicts of interest?'],
                ['conflictDetailsText', 'Conflict details:']
            ]);

            addSectionContent('3.7', 'Monitoring', [
                ['monitoringDetails', 'Please describe how the conduct of the research will be monitored:'],
                ['monitoringOtherText', 'Other monitoring details:']
            ]);

            // Add Section 4 content
            yPosition = addSectionHeader('SECTION 4 – CONFIDENTIALITY AND DATA MANAGEMENT', yPosition);

            addSectionContent('4.1', 'Personal Data', [
                ['personalData', '4.1 Are you collecting or processing personal data in this research project?'],
                ['dataProtectionTraining', 'DCU Data Protection training module on Loop completed:'],
                ['dataProtectionGuidance', 'Read the “Data Protection – Key Points for DCU Researchers” guidance:'],
                ['gdprRequirements', 'GDPR requirements met:'],
                ['personalDataNotInvolvedJustificationText', 'Justification for no personal data involved:']
            ]);

            addSectionContent('4.2', 'Data Access', [
                ['dataAccess', 'Is access to participant data confined to the investigators named on this application?'],
                ['dataAccessYesDetails', 'Data access details for Yes:'],
                ['dataAccessNoDetails', 'Data access details for No:']
            ]);

            yPosition = addSectionHeader('4.3 Data Storage', yPosition);
            yPosition = addCheckbox('Data collected on mobile devices will be protected with a strong password/passphrase at a minimum, and/or encrypted if the device supports it', localStorage.getItem('mobileDevicesSecurity') === 'true', yPosition);
            yPosition = addCheckbox('Data will be removed from mobile devices as soon as practicable and stored in a secured location in DCU (on server or institutional Google Drive)', localStorage.getItem('dataRemoval') === 'true', yPosition);
            yPosition = addCheckbox('Paper-based data will be held securely in locked cabinets in DCU, with access restricted to the named researchers', localStorage.getItem('paperBasedSecurity') === 'true', yPosition);

            yPosition = addNewPageIfNeeded(yPosition);

            // Add Section 4.4 checkboxes
            addSectionContent('4.4', 'Data Responsibility', [
                ['dataResponsibility', 'Responsible for secure storage of data:']
            ]);

            addSectionContent('4.5', 'Data Retention', [
                ['dataRetention', 'How long will the data be held for?'],
                ['otherRetentionDetails', 'Specify other retention period:']
            ]);

            // Add Section 4.6 checkboxes
            yPosition = addSectionHeader('4.6 Data Disposition', yPosition);

            addSectionContent('4.6', 'Data Disposition', [
                ['dataDisposition', 'What will happen at the end of the period mentioned in 4.5?'],
                ['archivedDataStaff', 'Name the DCU staff member responsible for archival and future use of data:'],
                ['dataAvailability', 'Confirm whether the data will be made available to other researchers:'],
                ['dataPreparation', 'Confirm how the data will be prepared for archive:'],
                ['dataAccess', 'Confirm where the data will be archived and who will be allowed to access it:'],
                ['dataDestructionReason', 'Justify why the data will be destroyed:'],
                ['dataDestructionResponsibility', 'Name the DCU researcher responsible for destruction of data:'],
                ['dataDestructionDate', 'Confirm when the data will be destroyed:'],
                ['dataDestructionMethod', 'Method of data destruction:'],
                ['otherDataDetailsText', 'Explain what will happen to the data if not being archived or destroyed:']
            ]);

            if (localStorage.getItem('dataDisposition') === 'Destroyed') {
                yPosition = addCheckbox('Electronic data will be overwritten/securely deleted', localStorage.getItem('electronicDataDestruction') === 'true', yPosition);
                yPosition = addCheckbox('Paper-based data will be confidentially shredded', localStorage.getItem('paperDataDestruction') === 'true', yPosition);
                yPosition = addCheckbox('Medical samples will be disposed in accordance with the relevant DCU approved SOP', localStorage.getItem('medicalSamplesDestruction') === 'true', yPosition);
            }

            // Add Section 5 content
            yPosition = addSectionHeader('SECTION 5 – INFORMATION AND INFORMED CONSENT PROCEDURES', yPosition);
            const items5_1 = [
                'intro_statement',
                'research_topic',
                'purpose',
                'invitation',
                'participation',
                'data_usage',
                'privacy',
                'benefits',
                'risks',
                'withdrawal',
                'project_outcomes',
                'contact_info'
            ];

            items5_1.forEach(item => {
                const value = localStorage.getItem(item);
                const yesSelected = value === 'yes' ? true : (value === 'no' ? false : null);
                yPosition = addYesNoOptions(item.replace(/_/g, ' '), yesSelected, yPosition);
                yPosition = addNewPageIfNeeded(yPosition);
            });

            // Add explanation for "No" responses in Section 5.1
            const noExplanation = localStorage.getItem('location');
            if (noExplanation) {
                yPosition = addSubsection('Explanation for No responses:', noExplanation, yPosition);
            }

            yPosition = addSectionHeader('5.2 Informed Consent Procedures', yPosition);
            const consentRequired = localStorage.getItem('consentRequired');
            if (consentRequired) {
                yPosition = addSubsection('Will written consent be obtained?', consentRequired === 'yes' ? 'Yes' : 'No', yPosition);
                if (consentRequired === 'yes') {
                    yPosition = addSubsection('Consent Description:', localStorage.getItem('consentDescription'), yPosition);
                } else {
                    yPosition = addSubsection('No Consent Description:', localStorage.getItem('noConsentDescription'), yPosition);
                    yPosition = addSubsection('Consent Not Needed Justification:', localStorage.getItem('noConsentJustificationText'), yPosition);
                }
            }

            // Add Section 6 content
            yPosition = addSectionHeader('SECTION 6 – SUBMISSION CHECKLIST AND RESEARCHER DECLARATION', yPosition);
            const items6_1 = [
                'infoSheet',
                'consentForms',
                'assentForms',
                'recruitmentAd',
                'questionnaire',
                'interviewQuestions',
                'debriefingMaterial',
                'bibliography',
                'ethicsApproval',
                'externalApprovals',
                'internalApprovals',
                'other'
            ];

            items6_1.forEach(item => {
                const value = localStorage.getItem(item);
                const yesSelected = value === 'yes' ? true : (value === 'no' ? false : null);
                yPosition = addYesNoOptions(item.replace(/_/g, ' '), yesSelected, yPosition);
                yPosition = addNewPageIfNeeded(yPosition);
            });

            // Add "Other" details if present
            const otherDetails = localStorage.getItem('otherDetails');
            if (otherDetails) {
                yPosition = addSubsection('Other Details:', otherDetails, yPosition);
            }

            yPosition = addSectionHeader('6.2 Signed Declaration', yPosition);
            const declarationItems = [
                ['supervisorSignature', 'Supervisor(s) Signature'],
                ['supervisorName', 'Supervisor Name(s)'],
                ['supervisorDateSigned', 'Date']
            ];

            declarationItems.forEach(([id, label]) => {
                const value = localStorage.getItem(id);
                if (value) {
                    yPosition = addSubsection(label, value, yPosition);
                }
            });

            // Save PDF
            doc.save('research_submission.pdf');
        }

        function resetForm() {
            // Clear all localStorage items
            localStorage.clear();
            alert("Form has been reset.");
            window.location.href = 'page_1.html'; // Redirect to the first page of the form
        }

        // Load the saved data for checkboxes in 4.1, 4.3, and 4.4
        document.addEventListener('DOMContentLoaded', (event) => {
            const formElements = document.querySelectorAll('input[type="checkbox"], input[type="radio"], textarea');
            formElements.forEach(element => {
                const storedValue = localStorage.getItem(element.id);
                if (storedValue !== null) {
                    if (element.type === 'checkbox' || element.type === 'radio') {
                        element.checked = storedValue === 'true';
                    } else {
                        element.value = storedValue;
                    }
                }
            });
        });

        // Function to toggle display of explanation textarea when "No" is selected
        function toggleTextarea() {
            var noSelected = false;
            var allQuestions = ["intro_statement", "research_topic", "purpose", "invitation", "participation", "data_usage", "privacy", "benefits", "risks", "withdrawal", "project_outcomes", "contact_info"];
            allQuestions.forEach(function (question) {
                var noRadio = document.getElementById(question + '_no');
                if (noRadio && noRadio.checked) {
                    noSelected = true;
                }
            });
            document.getElementById('noExplanation').style.display = noSelected ? 'block' : 'none';
        }

        // Save form data to localStorage
        function saveFormData() {
            const formElements = document.querySelectorAll('input[type="checkbox"], input[type="radio"], textarea');
            formElements.forEach(element => {
                if (element.type === 'checkbox' || element.type === 'radio') {
                    localStorage.setItem(element.id, element.checked);
                } else {
                    localStorage.setItem(element.id, element.value);
                }
            });
        }
    </script>
</body>

</html>
