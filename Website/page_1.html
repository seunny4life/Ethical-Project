<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Research Ethics Application Form</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Link to custom CSS -->
    <link rel="stylesheet" href="/Design/styles.css">
</head>

<body>
    <!-- General Details Section -->
    <div class="container">
        <h2 class="section-heading">
            SECTION 1 â€“ GENERAL DETAILS
        </h2>
        <form id="applicationForm" onsubmit="return validateForm()">
            <!-- Section 1.1 - Project Title -->
            <fieldset class="fieldset">
                <legend><strong>1.1 Project Title:</strong></legend>
                <input type="text" id="projectTitle" name="projectTitle" class="form-control" required>
            </fieldset>

            <!-- Section 1.2 - Applicant Details -->
            <fieldset class="fieldset">
                <legend><strong>1.2 Applicant Details:</strong></legend>
                <!-- First Principal Investigator -->
                <fieldset class="fieldset" id="principalInvestigatorSection">
                    <legend>DCU Principal Investigator(s)</legend>
                    <p>In the case of PhD/D.Ed./Research Masters projects, the supervisor must be listed as Principal
                        Investigator.</p>
                    <div class="form-group">
                        <label for="piName1">Name:</label>
                        <input type="text" id="piName1" name="piName1" class="form-control piName" required>
                        <label for="schoolUnit1">School/Unit:</label>
                        <input type="text" id="schoolUnit1" name="schoolUnit1" class="form-control" required>
                        <label for="email1">Email:</label>
                        <input type="email" id="email1" name="email1" class="form-control" required><br>
                    </div>
                </fieldset>
                <button type="button" class="btn btn-secondary" onclick="addPrincipalInvestigator()">Add Principal
                    Investigator</button>

                <!-- Section for Other Investigators -->
                <fieldset class="fieldset" id="otherInvestigatorsSection">
                    <legend>Other Investigators</legend>
                    <p>Including any external to DCU</p>
                    <div class="form-group">
                        <label for="otherName1">Name:</label>
                        <input type="text" id="otherName1" name="otherName1" class="form-control otherName">
                        <label for="otherUnit1">School/Unit/External Institution:</label>
                        <input type="text" id="otherUnit1" name="otherUnit1" class="form-control">
                        <label for="otherEmail1">Email:</label>
                        <input type="email" id="otherEmail1" name="otherEmail1" class="form-control"><br>
                    </div>
                </fieldset>
                <button type="button" class="btn btn-secondary" onclick="addOtherInvestigator()">Add Other
                    Investigator</button>
            </fieldset>

            <!-- Section 1.3 - Key Project Dates -->
            <fieldset class="fieldset">
                <legend><strong>1.3 Key Project Dates:</strong></legend>
                <div class="form-group">
                    <label for="startDate">Proposed start date for data collection:</label>
                    <input type="date" id="startDate" name="startDate" class="form-control" required>
                    <label for="endDate">Proposed end date for data collection:</label>
                    <input type="date" id="endDate" name="endDate" class="form-control" required>
                    <label for="completionDate">Proposed project completion date:</label>
                    <input type="date" id="completionDate" name="completionDate" class="form-control" required><br>
                </div>
            </fieldset>

            <!-- Section 1.4 - Level of Review (Hidden for now) -->
            <fieldset class="fieldset" id="levelOfReview" style="display: none;">
                <legend><strong>1.4 Please tick the checkbox for the appropriate level of required review:</strong>
                </legend>
                <div class="form-group">
                    <p><i>Consult the Level of Review advice in the Information and Guidance section of the <a
                                href="https://www.dcu.ie/researchsupport/research-ethics" target="_blank"><strong>DCU
                                    Research Ethics webpage.</strong></a></i></p>
                    <label for="fullCommittee">Full Committee</label>
                    <input type="checkbox" id="fullCommittee" name="reviewLevel" value="Full Committee">
                    <br>
                    <label for="expedited">Expedited</label>
                    <input type="checkbox" id="expedited" name="reviewLevel" value="Expedited">
                    <br>
                    <label for="notification">Notification</label>
                    <input type="checkbox" id="notification" name="reviewLevel" value="Notification">
                    <br>
                    <label for="survey">Survey</label>
                    <input type="checkbox" id="survey" name="reviewLevel" value="Survey">
                </div>
            </fieldset>

            <!-- Section 1.5 - Academic Award -->
            <fieldset class="fieldset">
                <legend><strong>1.5 Please indicate if this project is for an academic award:</strong></legend>
                <div class="form-group">
                    <label for="academicAward">Academic Award</label>
                    <select id="academicAward" name="academicAward" class="form-control" required>
                        <option value="" disabled selected>Select an option</option>
                        <option value="CA326">CA326</option>
                        <option value="CA400">CA400</option>
                        <option value="CA4021">CA4021</option>
                        <option value="CA472">CA472</option>
                        <option value="CA5377">CA5377</option>
                        <option value="CA550">CA550</option>
                        <option value="CA690">CA690</option>
                        <option value="CA691">CA691</option>
                        <option value="MCM">MCM</option>
                    </select>
                </div>
            </fieldset>

            <!-- Section 1.6 - Research Location -->
            <fieldset class="fieldset">
                <legend><strong>1.6 Indicate location(s) where the research will be carried out:</strong></legend>
                <div class="form-group">
                    <label><input type="checkbox" name="location" value="DCU campus"> DCU campus</label><br>
                    <label><input type="checkbox" name="location" value="Dublin City"> Dublin City</label><br>
                    <label><input type="checkbox" name="location" value="Republic of Ireland"> Republic of
                        Ireland</label><br>
                    <label><input type="checkbox" name="location" value="Online / On the Internet"> Online / On the
                        Internet</label><br>
                    <label><input type="checkbox" name="location" value="Other" onclick="toggleOtherLocation(this)">
                        Other</label><br>
                    <textarea id="otherLocation" name="otherLocation" class="form-control" style="display: none;"
                        placeholder="Please specify"></textarea>
                </div>
            </fieldset>

            <!-- Section 1.7 - Access to Participants -->
            <fieldset class="fieldset">
                <legend><strong>1.7 What additional permissions are required to access these locations?</strong>
                </legend>
                <div class="form-group">
                    <p><i>If you specified DCU campus, you might need permission to use a classroom, for example.</i>
                    </p>
                    <textarea id="permissions" name="permissions" class="form-control" required></textarea>
                </div>
            </fieldset>

            <!-- Section 1.8 - Other Ethics Committee Review -->
            <fieldset class="fieldset">
                <legend><strong>1.8 Has this project been submitted to another research ethics committee for
                        review?</strong></legend>
                <div class="form-group">
                    <input type="radio" id="yesReview" name="otherCommitteeReview" value="Yes"
                        onclick="toggleReviewDetails(true)" required>
                    <label for="yesReview">Yes</label>
                    <input type="radio" id="noReview" name="otherCommitteeReview" value="No"
                        onclick="toggleReviewDetails(false)">
                    <label for="noReview">No</label>
                    <div id="reviewDetails" style="margin-top: 10px; display: none;">
                        <label for="detailsOutcome"><i>If yes, please provide details on the outcome below (a copy of
                                approval should be attached to this form)</i></label>
                        <textarea id="detailsOutcome" name="detailsOutcome" class="form-control" required></textarea>
                    </div>
                </div>
            </fieldset>

            <!-- Button to Previous and Next step -->
            <div class="buttons">
                <!-- Previous Button -->
                <button type="button" class="btn btn-secondary" onclick="history.back();">Previous</button>

                <!-- Next Page Button -->
                <button type="submit" class="btn btn-primary">Next Page</button>
            </div>
    </div>
    </form>
    </div>
    <br><br>

    <!-- Bootstrap JS CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        function validateForm() {
            // Validate Section 1.1 - Project Title
            const projectTitle = document.getElementById("projectTitle").value.trim();
            if (projectTitle === "") {
                alert("Please enter the Project Title.");
                document.getElementById("projectTitle").focus();
                return false;
            }

            // Validate Section 1.2 - Applicant Details
            const piNames = document.querySelectorAll(".piName");
            for (let piName of piNames) {
                if (piName.value.trim() === "") {
                    alert("Please enter the name of all Principal Investigators.");
                    piName.focus();
                    return false;
                }
            }

            const schoolUnits = document.querySelectorAll("input[name='schoolUnit']");
            for (let schoolUnit of schoolUnits) {
                if (schoolUnit.value.trim() === "") {
                    alert("Please enter the school/unit of all Principal Investigators.");
                    schoolUnit.focus();
                    return false;
                }
            }

            const principalEmails = document.querySelectorAll("#principalInvestigatorSection input[name='email']");
            for (let email of principalEmails) {
                if (email.value.trim() === "") {
                    alert("Please enter the email of all Principal Investigators.");
                    email.focus();
                    return false;
                }
            }

            // Validate Section 1.3 - Key Project Dates
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;
            const completionDate = document.getElementById("completionDate").value;
            const today = new Date().setHours(0, 0, 0, 0);

            if (new Date(startDate).setHours(0, 0, 0, 0) < today) {
                alert("Proposed start date for data collection must be today or a future date.");
                document.getElementById("startDate").focus();
                return false;
            }

            if (new Date(endDate) <= new Date(startDate)) {
                alert("End date must be after start date.");
                document.getElementById("endDate").focus();
                return false;
            }

            if (new Date(completionDate) <= new Date(endDate)) {
                alert("Project completion date must be after end date.");
                document.getElementById("completionDate").focus();
                return false;
            }

            // Validate Section 1.5 - Academic Award
            const academicAward = document.getElementById("academicAward").value;
            if (academicAward === "") {
                alert("Please select an academic award.");
                document.getElementById("academicAward").focus();
                return false;
            }

            // Validate Section 1.6 - Research Location
            const locationCheckboxes = document.querySelectorAll('input[name="location"]');
            let isLocationSelected = false;
            for (let checkbox of locationCheckboxes) {
                if (checkbox.checked) {
                    isLocationSelected = true;
                    break;
                }
            }

            if (!isLocationSelected) {
                alert("Please select at least one location in section 1.6.");
                return false;
            }

            // Validate Section 1.7 - Access to Participants
            const permissions = document.getElementById("permissions").value.trim();
            if (permissions === "") {
                alert("Please specify the additional permissions required to access these locations.");
                document.getElementById("permissions").focus();
                return false;
            }

            // Validate Section 1.8 - Other Ethics Committee Review
            const otherCommitteeReview = document.querySelector('input[name="otherCommitteeReview"]:checked');
            if (!otherCommitteeReview) {
                alert("Please specify if the project has been submitted to another research ethics committee for review.");
                return false;
            }

            if (otherCommitteeReview.value === "Yes") {
                const detailsOutcome = document.getElementById("detailsOutcome").value.trim();
                if (detailsOutcome === "") {
                    alert("Please provide details on the outcome of the other ethics committee review.");
                    document.getElementById("detailsOutcome").focus();
                    return false;
                }
            }

            saveFormData();
            window.location.href = 'page_2.html';
            return false;
        }

        function saveFormData() {
            const formData = new FormData(document.getElementById('applicationForm'));
            let piNames = [];
            let piSchools = [];
            let piEmails = [];
            let otherNames = [];
            let otherUnits = [];
            let otherEmails = [];
            let locations = [];

            formData.forEach((value, key) => {
                if (key.startsWith('piName')) {
                    piNames.push(value);
                } else if (key.startsWith('schoolUnit')) {
                    piSchools.push(value);
                } else if (key.startsWith('email')) {
                    piEmails.push(value);
                } else if (key.startsWith('otherName')) {
                    otherNames.push(value);
                } else if (key.startsWith('otherUnit')) {
                    otherUnits.push(value);
                } else if (key.startsWith('otherEmail')) {
                    otherEmails.push(value);
                } else if (key.startsWith('location')) {
                    locations.push(value);
                } else {
                    localStorage.setItem(key, value);
                }
            });

            if (piNames.length > 0) {
                localStorage.setItem('piNames', JSON.stringify(piNames));
            }
            if (piSchools.length > 0) {
                localStorage.setItem('piSchools', JSON.stringify(piSchools));
            }
            if (piEmails.length > 0) {
                localStorage.setItem('piEmails', JSON.stringify(piEmails));
            }
            if (otherNames.length > 0) {
                localStorage.setItem('otherNames', JSON.stringify(otherNames));
            }
            if (otherUnits.length > 0) {
                localStorage.setItem('otherUnits', JSON.stringify(otherUnits));
            }
            if (otherEmails.length > 0) {
                localStorage.setItem('otherEmails', JSON.stringify(otherEmails));
            }
            if (locations.length > 0) {
                localStorage.setItem('locations', JSON.stringify(locations));
            }
        }

        function addPrincipalInvestigator() {
            const section = document.getElementById('principalInvestigatorSection');
            const newInvestigator = document.createElement('div');
            newInvestigator.className = 'form-group';
            newInvestigator.innerHTML = `
                <label>Name:</label>
                <input type="text" name="piName" class="form-control piName" required>
                <label>School/Unit:</label>
                <input type="text" name="schoolUnit" class="form-control" required>
                <label>Email:</label>
                <input type="email" name="email" class="form-control" required><br>
            `;
            section.appendChild(newInvestigator);
        }

        function addOtherInvestigator() {
            const section = document.getElementById('otherInvestigatorsSection');
            const newInvestigator = document.createElement('div');
            newInvestigator.className = 'form-group';
            newInvestigator.innerHTML = `
                <label>Name:</label>
                <input type="text" name="otherName" class="form-control otherName">
                <label>School/Unit/External Institution:</label>
                <input type="text" name="otherUnit" class="form-control">
                <label>Email:</label>
                <input type="email" name="otherEmail" class="form-control"><br>
            `;
            section.appendChild(newInvestigator);
        }

        function toggleReviewDetails(show) {
            const reviewDetails = document.getElementById('reviewDetails');
            reviewDetails.style.display = show ? 'block' : 'none';
            document.getElementById('detailsOutcome').required = show;
        }

        function toggleOtherLocation(checkbox) {
            const otherLocation = document.getElementById('otherLocation');
            otherLocation.style.display = checkbox.checked ? 'block' : 'none';
        }
    </script>
</body>

</html>